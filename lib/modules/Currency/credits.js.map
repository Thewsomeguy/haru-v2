{"version":3,"sources":["modules/Currency/credits.js"],"names":[],"mappings":"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","file":"modules/Currency/credits.js","sourcesContent":["import moment from 'moment'\n\nimport BaseCommand from '../../base/BaseCommand'\nimport { Banker, Claims } from '../.Cache/Bank'\n\nclass Credits extends BaseCommand {\n  static get name () {\n    return 'credits'\n  }\n\n  static get description () {\n    return 'Currency system'\n  }\n\n  static get usage () {\n    return [\n      '```',\n      '== Credits Management System ==',\n      '```',\n      'Credits are a virtual currency that can be used in any server the bot is in.',\n      [\n        '**give** <user> <no. of credits> [message] - Sends credits to a user',\n        '**peek** <user> - Takes a peek at a user\\'s number of credits',\n        '**lb** - Gets the rankings for credit amounts',\n        '**claim** - Claims your daily credits, usable every 24 hours'\n      ]\n    ]\n  }\n\n  handle () {\n    this.responds(/^credits$/i, () => {\n      Banker.getUser(this.sender, (err, amt) => {\n        if (err) {\n          this.logger.error(`${this.sender.name} met an error fetching credits`, err)\n          this.reply('Error fetching credits amount:\\n' + err)\n          return\n        }\n        this.reply(`You have **${parseInt(amt, 10)}** credits.`)\n      })\n    })\n\n    this.responds(/^credits (leaderboards|lb|rankings)$/i, () => {\n      Banker.sortRank(10, (err, res) => {\n        if (err) {\n          this.logger.error(`${this.sender.name} met an error fetching credits rankings`, err)\n          this.reply('Error fetching credits leaderboard:\\n' + err)\n          return\n        }\n        let ranking = ['```rb', '== DISCORD WEALTH RANKINGS ==']\n        for (let i = 0, j = 1; i < Math.min(res.length, 20); i += 2, j++) {\n          ranking.push([\n            `${j}. ${this.client.users.get('id', res[i]).name} - ${res[i + 1]} credits`\n          ])\n        }\n        ranking.push('```')\n        this.send(this.channel, ranking.join('\\n'))\n      })\n    })\n\n    this.responds(/^credits (give|send) <@!*(\\d+)> (\\d+)(\\s.+)*$/i, matches => {\n      let amt = parseInt(matches[3], 10)\n      let recipient = this.client.users.get('id', matches[2])\n      if (recipient) {\n        Banker.getUser(this.sender, (err, res) => {\n          if (err) {\n            this.logger.error(`${this.sender.name} met an error fetching credits`, err)\n            this.reply('Error fetching credits amount:\\n' + err)\n            return\n          }\n          if (res) {\n            if (parseInt(res, 10) < amt) {\n              this.reply(`You have insufficient (**${res}**) credits.`)\n              return\n            } else {\n              Banker.delCredits(this.sender, matches[3], (err, res) => {\n                if (err) {\n                  this.logger.error(`${this.sender.name} met an error removing credits`, err)\n                  this.reply('Error removing credits:\\n' + err)\n                  return\n                }\n                Banker.addCredits(matches[2], matches[3], (err, res) => {\n                  if (err) {\n                    this.logger.error(`${this.sender.name} met an error sending credits`, err)\n                    this.reply('Error sending credits:\\n' + err)\n                    return\n                  }\n                  let receipt = [\n                    '```ruby',\n                    '=== RECEIPT ===',\n                    `FROM: ${this.sender.name}`,\n                    `AMOUNT: ${amt} credits`,\n                    `FOR: ${recipient.name}`\n                  ]\n                  if (matches[4]) {\n                    receipt.push(`DESCRIPTION: ${matches[4]}`)\n                  }\n                  this.send(recipient, receipt.join('\\n'))\n                  this.reply(`Sent ${recipient.mention()} **${amt}** credits.`)\n                })\n              })\n            }\n          }\n        })\n      }\n    })\n\n    this.responds(/^credits peek <@!*(\\d+)>$/i, matches => {\n      let user = this.client.users.get('id', matches[1])\n      if (user) {\n        Banker.getUser(matches[1], (err, res) => {\n          if (err) {\n            this.logger.error(`${this.sender.name} met an error fetching credits`, err)\n            this.reply('Error fetching credits amount:\\n' + err)\n            return\n          }\n          this.reply(`**${user.name}** has **${parseInt(res, 10)}** credits.`)\n        })\n      }\n    })\n\n    this.responds(/^credits claim/i, () => {\n      Claims.get(this.sender.id, (err, res) => {\n        if (err) {\n          this.logger.error(`${this.sender.name} met an error fetching credit claims DB`, err)\n          this.reply('Error fetching credit claims DB:\\n' + err)\n          return\n        }\n        let amount = Math.floor(Math.random() * 400) + 100\n        if (res) {\n          let diff = moment().diff(moment(res), 'hours')\n          if (diff < 24) {\n            this.reply(\n              'You have claimed your daily credits.\\n' +\n              `Check back after **${24 - diff}** hours.`\n            )\n            return\n          } else {\n            Claims.set(this.sender.id, +moment(), (err, res) => {\n              if (err) {\n                this.logger.error(`${this.sender.name} met an error resetting claim timer`, err)\n                this.reply('Error resetting claim timer:\\n' + err)\n                return\n              }\n            })\n            Banker.addCredits(this.sender, amount, (err, res) => {\n              if (err) {\n                this.logger.error(`${this.sender.name} met an error claiming credits`, err)\n                this.reply('Error claiming credits:\\n' + err)\n                return\n              }\n              this.send(this.channel,\n                `**${amount}** credits added to ${this.sender.mention()}'s account.`\n              )\n            })\n          }\n        } else {\n          Claims.set(this.sender.id, +moment(), (err, res) => {\n            if (err) {\n              this.logger.error(`${this.sender.name} met an error resetting claim timer`, err)\n              this.reply('Error resetting claim timer:\\n' + err)\n              return\n            }\n          })\n          Banker.setCredits(this.sender, amount + 100, (err, res) => {\n            if (err) {\n              this.logger.error(`${this.sender.name} met an error claiming credits`, err)\n              this.reply('Error claiming credits:\\n' + err)\n              return\n            }\n            this.send(this.channel,\n              `**${amount}** credits added to ${this.sender.mention()}'s account.`\n            )\n          })\n        }\n      })\n    })\n  }\n}\n\nmodule.exports = Credits\n"],"sourceRoot":"/Users/AaronTua/Desktop/code/fuyu/src"}