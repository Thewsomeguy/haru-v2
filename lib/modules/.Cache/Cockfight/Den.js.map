{"version":3,"sources":["modules/.Cache/Cockfight/Den.js"],"names":[],"mappings":"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","file":"modules/.Cache/Cockfight/Den.js","sourcesContent":["import { EventEmitter } from 'events'\nimport _ from 'lodash'\n\nimport Database from '../../../util/Database'\n\nlet Cockfights = new Database('cockfights')\n\nclass Den extends EventEmitter {\n  constructor () {\n    super()\n    this.listen()\n    this.arenas = {}\n    this.players = []\n  }\n\n  listen () {\n    this.on('REQUEST_SENT', id => {\n      setTimeout(() => {\n        if (this.hasArena(id)) {\n          let arena = this.getArena(id)\n          if (this.getArena(id).state === 'waiting') {\n            this.emit('REQUEST_IGNORED:' + id, arena)\n            this.emit('REQUEST_IGNORED', id)\n          }\n        }\n      }, 60000)\n    })\n\n    this.on('REQUEST_IGNORED', id => {\n      this.deleteArena(id)\n    })\n\n    this.on('BETTING_START', id => {\n      let arena = this.getArena(id)\n      if (arena) {\n        setTimeout(() => {\n          this.emit('BETTING_END:' + id, arena)\n          this.emit('BETTING_END', id)\n        }, 60000)\n      }\n    })\n\n    this.on('BETTING_END', id => {\n      this.start(id)\n    })\n\n    this.on('ARENA_START', id => {\n      let arena = this.getArena(id)\n      if (arena) {\n        // Empty, probably\n      }\n    })\n\n    this.on('ARENA_END', id => {\n      let arena = this.getArena(id)\n      if (arena) {\n        setTimeout(() => {\n          this.deleteArena(id)\n        }, 10000)\n      }\n    })\n  }\n\n  get (id) {\n    return new Promise((res, rej) => {\n      Cockfights.get(id, (err, result) => {\n        if (err) return rej(err)\n        res(result)\n      })\n    })\n  }\n\n  set (id, val) {\n    return new Promise((res, rej) => {\n      Cockfights.set(id, val, (err, result) => {\n        if (err) return rej(err)\n        res(result)\n      })\n    })\n  }\n\n  register (id, arena) {\n    arena.state = 'waiting'\n    this.save(id, arena)\n    this.players.push(arena.player1)\n    this.players.push(arena.player2)\n    this.emit('REQUEST_SENT:' + id, arena)\n    this.emit('REQUEST_SENT', id)\n  }\n\n  getArena (id) {\n    return this.arenas[id]\n  }\n\n  hasArena (id) {\n    return typeof this.arenas[id] !== 'undefined'\n  }\n\n  isIngame (id) {\n    return this.players.indexOf(id) > -1\n  }\n\n  deleteArena (id) {\n    let arena = this.getArena(id)\n    if (arena) {\n      _.pull(this.players, arena.player1, arena.player2)\n      delete this.arenas[id]\n    } else {\n      return false\n    }\n  }\n\n  accepted (id) {\n    let arena = this.getArena(id)\n    if (arena) {\n      arena.waiting = null\n      arena.state = 'betting'\n      arena.bets[arena.player1] = []\n      arena.bets[arena.player2] = []\n      this.save(id, arena)\n      this.emit('BETTING_START:' + id, arena)\n      this.emit('BETTING_START', id)\n    } else {\n      return false\n    }\n  }\n\n  start (id) {\n    let arena = this.getArena(id)\n    if (arena) {\n      arena.state = 'ingame'\n      this.save(id, arena)\n      this.emit('ARENA_START:' + id, arena)\n      this.emit('ARENA_START', id)\n    } else {\n      return false\n    }\n  }\n\n  end (id, winner, loser) {\n    let arena = this.getArena(id)\n    if (arena) {\n      arena.state = 'idle'\n      this.save(id, arena)\n      this.emit('ARENA_END:' + id, arena, winner, loser)\n      this.emit('ARENA_END', id)\n      this.emit('BETTING_WON', winner, arena.bets[winner.id])\n      this.emit('BETTING_LOST', loser, arena.bets[loser.id])\n    } else {\n      return false\n    }\n  }\n\n  placeBet (id, player, bet) {\n    let arena = this.getArena(id)\n    if (arena) {\n      switch (player) {\n        case arena.player1: {\n          arena.bets[arena.player1].push(bet)\n          break\n        }\n        case arena.player2: {\n          arena.bets[arena.player2].push(bet)\n          break\n        }\n        default:\n          return false\n      }\n      this.save(id, arena)\n    } else {\n      return false\n    }\n  }\n\n  save (id, arena) {\n    this.arenas[id] = arena\n  }\n}\n\nmodule.exports = Den\n"],"sourceRoot":"/Users/AaronTua/Desktop/code/fuyu/src"}